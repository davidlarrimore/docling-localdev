# Docling for macOS (Apple Silicon)

This repository streamlines local deployment of Docling on macOS, with defaults tuned for Apple Silicon GPU acceleration (Metal/MPS). It provides an easy way to run Docling Serve locally and an optional menu bar app for seamless control.

## What This Project Provides
- A repeatable macOS setup script that creates a Python 3.12 virtual environment and installs Docling + Docling Serve.
- Apple Silicon environment defaults for better performance (e.g., `DOCLING_DEVICE=auto`, `PYTORCH_ENABLE_MPS_FALLBACK=1`).
- A `run-docling-local-apple-silicon.sh` helper to start Docling Serve locally with consistent settings.
- A Swift-based menu bar app that auto-starts Docling and provides Start/Stop/Restart controls with no terminal windows.

## Quick Start

### Option A: Terminal (Script)

1) Install dependencies and download models:
   ```bash
   ./setup.sh
   ```

2) Start Docling Serve:
   ```bash
   ./run-docling-local-apple-silicon.sh
   ```

3) Open the UI:
   ```bash
   open http://localhost:5001/ui
   ```

### Option B: Menu Bar App (Recommended)

The menu bar app provides a cleaner experience with no terminal windows.

1) Run setup first (if not already done):
   ```bash
   ./setup.sh
   ```

2) Build the menu bar app:
   ```bash
   ./macos/DoclingMenuBar/build-app.sh
   ```

3) Launch the app:
   ```bash
   open build/DoclingMenuBar.app
   ```

The app will:
- Auto-detect your Docling installation
- Start Docling Serve automatically
- Show a status indicator in the menu bar (green = online, orange = starting, red = offline)
- Provide Start/Stop/Restart controls
- Open Docling UI and website links
- Cleanly shut down Docling when you quit

### Option C: Auto-Start at Login

After building the menu bar app, install a LaunchAgent to start it automatically at login:

```bash
./macos/DoclingMenuBar/install-launchagent.sh
```

To uninstall:
```bash
launchctl unload ~/Library/LaunchAgents/com.docling.menubar.plist
rm ~/Library/LaunchAgents/com.docling.menubar.plist
```

## GPU Acceleration on macOS

The setup and run scripts set Apple Silicon-friendly defaults so Docling can leverage MPS (Metal Performance Shaders). Key environment variables include:
- `DOCLING_DEVICE=auto`
- `DOCLING_APPLE_OPTIMIZED=1`
- `PYTORCH_ENABLE_MPS_FALLBACK=1`

You can override any of these variables in your shell or by editing `run-docling-local-apple-silicon.sh`.

## Project Layout

```
docling/
├── setup.sh                           # Install dependencies and download models
├── run-docling-local-apple-silicon.sh # Start Docling Serve (generated by setup.sh)
├── requirements.txt                   # Pinned Python dependencies
├── logo.png                           # App icon source
├── macos/DoclingMenuBar/
│   ├── main.swift                     # Menu bar app source
│   ├── build-app.sh                   # Build script
│   └── install-launchagent.sh         # Auto-start installer
├── build/                             # Generated app bundle (git-ignored)
├── artifacts/                         # Downloaded ML models (git-ignored)
├── scratch/                           # Temporary working data (git-ignored)
└── venv/                              # Python virtual environment (git-ignored)
```

## Configuration

The menu bar app stores its config at:
```
~/Library/Application Support/DoclingMenuBar/config.json
```

Available options:
- `baseURL` - Docling Serve URL (default: `http://127.0.0.1:5001`)
- `pollIntervalSeconds` - Health check interval (default: `3.0`)
- `doclingInstallPath` - Override auto-detected path (default: auto-detect)
- `autoStartOnLaunch` - Start Docling when app launches (default: `true`)

## Notes

- This repo assumes macOS with Apple Silicon (M1/M2/M3). Intel Macs may need adjustments.
- If `docling-serve` is missing, re-run `./setup.sh` or `pip install -r requirements.txt` inside `venv/`.
- The menu bar app requires macOS 12.0 or later.
